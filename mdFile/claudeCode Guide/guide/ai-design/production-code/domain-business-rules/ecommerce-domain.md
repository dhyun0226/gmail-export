# 🛒 전자상거래 도메인 비즈니스 규칙

> 전자상거래 플랫폼의 복잡한 비즈니스 규칙 및 코드 생성 가이드

## 📋 전자상거래 도메인 개요

### **핵심 엔티티**
- Product (상품)
- Category (카테고리)
- Inventory (재고)
- Cart (장바구니)
- Order (주문)
- Payment (결제)
- Customer (고객)
- Coupon (쿠폰/할인)

### **주요 비즈니스 프로세스**
- 상품 관리 및 진열
- 재고 관리 및 예약
- 장바구니 및 주문 처리
- 결제 및 정산
- 배송 및 추적
- 고객 관리 및 마케팅

## 🏗️ 엔티티별 비즈니스 규칙

### **1. Product (상품) 도메인**

#### 상품 상태 관리
```yaml
상품_상태:
  - "DRAFT: 임시저장 (관리자만 조회 가능)"
  - "ACTIVE: 판매중 (고객 구매 가능)"
  - "INACTIVE: 판매중지 (조회만 가능)"
  - "OUT_OF_STOCK: 품절 (재입고 알림 가능)"
  - "DISCONTINUED: 단종 (더 이상 판매하지 않음)"

상태_전이_규칙:
  - "DRAFT → ACTIVE: 필수 정보 완성 검증"
  - "ACTIVE → INACTIVE: 언제든 가능"
  - "ACTIVE → OUT_OF_STOCK: 재고 0일 때 자동 전환"
  - "OUT_OF_STOCK → ACTIVE: 재고 추가시 자동 전환"
  - "* → DISCONTINUED: 관리자만 가능"
```

#### 가격 관리 규칙
```yaml
가격_정책:
  - "originalPrice: 정가 (필수, 0보다 커야 함)"
  - "salePrice: 판매가 (정가 이하)"
  - "discountRate: 할인율 (0-100%)"
  - "memberPrice: 회원가 (선택적)"

가격_검증:
  - "salePrice <= originalPrice"
  - "discountRate = (originalPrice - salePrice) / originalPrice * 100"
  - "최소 판매가 설정 (원가 이하 방지)"
  - "가격 변경 이력 관리 (PriceHistory)"

프로모션_가격:
  - "프로모션 기간 한정 가격"
  - "수량 제한 할인 (첫 N개 한정)"
  - "시간대별 차등 가격"
```

#### 상품 옵션 관리
```yaml
옵션_구조:
  - "옵션그룹 (색상, 사이즈, 용량 등)"
  - "옵션값 (빨강, XL, 500ml 등)"
  - "옵션 조합별 재고 관리"

옵션_규칙:
  - "필수 옵션 vs 선택 옵션"
  - "옵션 조합별 가격 차이"
  - "재고 없는 옵션 비활성화"
  - "옵션 변경시 가격 재계산"
```

### **2. Inventory (재고) 도메인**

#### 재고 관리 규칙
```yaml
재고_유형:
  - "physicalStock: 실제 재고"
  - "availableStock: 판매 가능 재고"
  - "reservedStock: 예약 재고 (장바구니, 주문 대기)"
  - "defectiveStock: 불량 재고"

재고_계산:
  - "availableStock = physicalStock - reservedStock - defectiveStock"
  - "안전 재고 수준 설정"
  - "자동 발주점 관리"

동시성_제어:
  - "재고 차감시 낙관적/비관적 락"
  - "재고 부족시 대기열 관리"
  - "동시 주문시 재고 충돌 방지"
```

#### 재고 예약 시스템
```yaml
예약_규칙:
  - "장바구니 담기: 10분간 임시 예약"
  - "주문 진행: 30분간 결제 대기"
  - "결제 완료: 정식 차감"
  - "시간 초과시 자동 해제"

예약_해제_조건:
  - "장바구니에서 삭제"
  - "결제 취소/실패"
  - "시간 초과"
  - "관리자 강제 해제"
```

### **3. Cart (장바구니) 도메인**

#### 장바구니 관리 규칙
```yaml
장바구니_정책:
  - "로그인 사용자: DB 저장, 영구 보관"
  - "비로그인 사용자: 세션/로컬스토리지, 7일 보관"
  - "로그인시 세션 장바구니 병합"

수량_제한:
  - "상품별 최대 구매 수량"
  - "고객별 일일 구매 한도"
  - "재고 수량 초과 방지"
  - "프로모션 상품 수량 제한"

가격_계산:
  - "상품 가격 × 수량"
  - "쿠폰 할인 적용"
  - "배송비 계산"
  - "총 결제 금액 산출"
```

#### 장바구니 유효성 검증
```yaml
검증_항목:
  - "상품 존재 여부"
  - "상품 판매 상태"
  - "재고 수량 확인"
  - "가격 정보 최신성"
  - "프로모션 유효성"

자동_정리:
  - "품절 상품 알림 후 제거"
  - "단종 상품 즉시 제거"
  - "가격 변동 알림"
  - "유효기간 경과 항목 제거"
```

### **4. Order (주문) 도메인**

#### 주문 상태 관리
```yaml
주문_상태:
  - "PENDING_PAYMENT: 결제 대기"
  - "PAID: 결제 완료"
  - "CONFIRMED: 주문 확정"
  - "PREPARING: 상품 준비"
  - "SHIPPED: 배송중"
  - "DELIVERED: 배송 완료"
  - "CANCELLED: 주문 취소"
  - "REFUNDED: 환불 완료"

상태_전이_규칙:
  - "PENDING_PAYMENT → PAID: 결제 성공"
  - "PAID → CONFIRMED: 재고 확인 후 자동"
  - "CONFIRMED → PREPARING: 관리자 처리"
  - "PREPARING → SHIPPED: 배송 시작"
  - "SHIPPED → DELIVERED: 배송 완료"
  - "취소 가능 상태: PENDING_PAYMENT, PAID, CONFIRMED"
```

#### 주문 검증 규칙
```yaml
주문_생성_검증:
  - "고객 정보 유효성"
  - "배송 주소 완전성"
  - "상품 재고 충분성"
  - "결제 금액 정확성"
  - "쿠폰 사용 가능성"

결제_전_재검증:
  - "재고 수량 재확인"
  - "가격 정보 재검증"
  - "프로모션 유효성 재확인"
  - "고객 구매 한도 확인"
```

#### 주문 취소/환불 규칙
```yaml
취소_정책:
  - "결제 전: 무조건 취소 가능"
  - "결제 후 24시간 내: 전액 취소"
  - "상품 준비 중: 수수료 부과 가능"
  - "배송 시작 후: 취소 불가, 반품으로 처리"

환불_처리:
  - "신용카드: 승인 취소 또는 부분 취소"
  - "계좌이체: 환불 계좌로 입금"
  - "포인트: 즉시 복원"
  - "쿠폰: 조건부 복원 (1회용 제외)"
```

### **5. Payment (결제) 도메인**

#### 결제 수단 관리
```yaml
결제_수단:
  - "CREDIT_CARD: 신용카드"
  - "BANK_TRANSFER: 계좌이체"
  - "VIRTUAL_ACCOUNT: 가상계좌"
  - "POINT: 포인트"
  - "COUPON: 쿠폰"
  - "MIXED: 복합 결제"

결제_검증:
  - "카드 유효성 검증"
  - "한도 확인"
  - "결제 가능 시간 확인"
  - "부정 거래 탐지"
```

#### 결제 보안 규칙
```yaml
보안_요구사항:
  - "PCI DSS 준수"
  - "카드 정보 암호화"
  - "토큰화 결제"
  - "3D Secure 인증"

거래_추적:
  - "모든 결제 시도 로깅"
  - "실패 원인 기록"
  - "부정 거래 패턴 분석"
  - "환불/취소 추적"
```

### **6. Coupon (쿠폰) 도메인**

#### 쿠폰 유형 및 규칙
```yaml
할인_유형:
  - "FIXED_AMOUNT: 정액 할인 (1000원 할인)"
  - "PERCENTAGE: 정율 할인 (10% 할인)"
  - "FREE_SHIPPING: 무료배송"
  - "BUY_ONE_GET_ONE: 1+1 이벤트"

사용_조건:
  - "최소 주문 금액"
  - "특정 상품/카테고리 한정"
  - "신규 고객 전용"
  - "생일 쿠폰 등 개인화"

사용_제한:
  - "1인 1회 사용"
  - "중복 사용 불가"
  - "유효기간 설정"
  - "재고 수량 (발급 한정)"
```

## 💻 코드 생성 패턴

### **상품 엔티티 생성**
```yaml
Product_클래스:
  - "기본 정보: name, description, brand"
  - "가격 정보: originalPrice, salePrice, discountRate"
  - "상태 관리: status, displayOrder"
  - "SEO: slug, metaTitle, metaDescription"
  - "이미지: 메인/상세 이미지 목록"

ProductOption_클래스:
  - "옵션 그룹: OptionGroup (색상, 사이즈)"
  - "옵션 값: OptionValue (빨강, XL)"
  - "가격 차이: additionalPrice"
  - "재고: 옵션별 개별 재고"

ProductVariant_클래스:
  - "옵션 조합: ProductOption 조합"
  - "SKU: 재고관리코드"
  - "가격: 조합별 가격"
  - "재고: 조합별 재고"
```

### **주문 엔티티 생성**
```yaml
Order_클래스:
  - "주문 정보: orderNumber, orderDate, status"
  - "고객 정보: customer, deliveryAddress"
  - "금액 정보: subtotal, discount, shipping, total"
  - "결제 정보: paymentMethod, paymentStatus"

OrderItem_클래스:
  - "상품 정보: product, productVariant"
  - "주문 수량: quantity"
  - "단가: unitPrice"
  - "총액: totalPrice"
  - "할인: itemDiscount"
```

### **서비스 레이어 생성**
```yaml
ProductService_메서드:
  - "상품 등록/수정/삭제"
  - "재고 확인/예약/차감"
  - "가격 계산/할인 적용"
  - "옵션 조합 생성"

OrderService_메서드:
  - "주문 생성/수정/취소"
  - "재고 예약/확정/해제"
  - "결제 연동/검증"
  - "배송 처리/추적"

CartService_메서드:
  - "장바구니 추가/수정/삭제"
  - "재고 검증/가격 계산"
  - "쿠폰 적용/할인 계산"
  - "주문 변환"
```

## 🔍 프론트엔드 생성 규칙

### **상품 관련 컴포넌트**
```yaml
ProductList_컴포넌트:
  - "상품 목록 그리드/리스트 뷰"
  - "카테고리/가격/브랜드 필터"
  - "정렬 옵션 (가격, 인기도, 등록일)"
  - "페이징 또는 무한 스크롤"

ProductDetail_컴포넌트:
  - "상품 이미지 갤러리"
  - "옵션 선택 UI"
  - "수량 선택 및 재고 표시"
  - "장바구니 담기/바로 구매"
  - "상품 문의/리뷰"

ProductOption_컴포넌트:
  - "옵션 그룹별 선택 UI"
  - "선택된 옵션 조합 표시"
  - "가격 변동 실시간 반영"
  - "재고 없는 옵션 비활성화"
```

### **주문 관련 컴포넌트**
```yaml
Cart_컴포넌트:
  - "장바구니 아이템 목록"
  - "수량 변경/삭제 기능"
  - "쿠폰 적용 영역"
  - "총 금액 계산 표시"

Checkout_컴포넌트:
  - "배송지 입력/선택"
  - "결제 수단 선택"
  - "주문 요약 정보"
  - "최종 결제 버튼"

OrderHistory_컴포넌트:
  - "주문 내역 목록"
  - "주문 상태별 필터"
  - "주문 상세 보기"
  - "취소/교환/반품 신청"
```

## 🧪 테스트 시나리오

### **핵심 비즈니스 로직 테스트**
```yaml
재고_관리_테스트:
  - "동시 주문시 재고 차감 정확성"
  - "재고 부족시 예외 처리"
  - "예약 재고 시간 초과 해제"

주문_프로세스_테스트:
  - "장바구니 → 주문 → 결제 전체 플로우"
  - "주문 취소시 재고 복원"
  - "부분 취소/환불 처리"

쿠폰_할인_테스트:
  - "쿠폰 적용 조건 검증"
  - "중복 할인 방지"
  - "최대 할인 한도 적용"
```

### **성능 테스트**
```yaml
대용량_처리:
  - "동시 사용자 1000명 주문 처리"
  - "상품 목록 10만개 조회 성능"
  - "장바구니 대용량 아이템 처리"

트래픽_집중:
  - "특가 상품 오픈시 트래픽 처리"
  - "결제 시스템 부하 테스트"
  - "재고 부족시 대기열 처리"
```

## 📊 비즈니스 메트릭

### **핵심 지표 추적**
```yaml
매출_지표:
  - "일별/월별 매출액"
  - "상품별 매출 기여도"
  - "고객별 구매 금액"
  - "평균 주문 금액(AOV)"

운영_지표:
  - "재고 회전율"
  - "주문 처리 시간"
  - "배송 지연율"
  - "고객 만족도"

마케팅_지표:
  - "신규 고객 획득 비용"
  - "고객 생애 가치(LTV)"
  - "장바구니 이탈률"
  - "쿠폰 사용률"
```

이 규칙을 바탕으로 AI가 전자상거래 도메인의 복잡한 비즈니스 로직을 포함한 완전한 애플리케이션 코드를 자동 생성합니다.